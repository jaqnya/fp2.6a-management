*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є 29/02/2004            COBROSS.PRG              15:18:05 є
*       є                                                         є
*       ЗДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД¶
*       є                                                         є
*       є Author's Name                                           є
*       є                                                         є
*       є Copyright (c) 2004 Company Name                         є
*       є Address                                                 є
*       є City,     Zip                                           є
*       є                                                         є
*       є Description:                                            є
*       є This program was automatically generated by GENSCRN.    є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є          COBROS/MS-DOS Setup Code - SECTION 1           є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

#REGION 1
IF plAdding
   pcMyTitle = " Crear Recibo de Cobro "
ELSE
   IF plEditing
      pcMyTitle = " Modificar Recibo de Cobro "
   ELSE
      IF plDeleting
         pcMyTitle = " Borrar Recibo de Cobro "
      ENDIF
   ENDIF
ENDIF


#REGION 0
REGIONAL m.currarea, m.talkstat, m.compstat

IF SET("TALK") = "ON"
	SET TALK OFF
	m.talkstat = "ON"
ELSE
	m.talkstat = "OFF"
ENDIF
m.compstat = SET("COMPATIBLE")
SET COMPATIBLE FOXPLUS

m.currarea = SELECT()


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є                MS-DOS Window definitions                є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

IF NOT WEXIST("_16g0wsoi2")
	DEFINE WINDOW _16g0wsoi2 ;
		FROM INT((SROW()-11)/2),INT((SCOL()-65)/2) ;
		TO INT((SROW()-11)/2)+10,INT((SCOL()-65)/2)+64 ;
		TITLE (pcMyTitle) ;
		FLOAT ;
		NOCLOSE ;
		SHADOW ;
		NOMINIMIZE ;
		COLOR SCHEME 1
ENDIF


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є          COBROS/MS-DOS Setup Code - SECTION 2           є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

#REGION 1
IF plAdding
   IF EMPTY(m.fechareci)
      m.fechareci = DTOC(DATE())
   ENDIF
ELSE
   IF plEditing
      IF TYPE("m.fechareci") = "D"
         m.fechareci = DTOC(m.fechareci)
      ENDIF
   ENDIF
ENDIF

*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є               COBROS/MS-DOS Screen Layout               є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

#REGION 1
IF WVISIBLE("_16g0wsoi2")
	ACTIVATE WINDOW _16g0wsoi2 SAME
ELSE
	ACTIVATE WINDOW _16g0wsoi2 NOSHOW
ENDIF
@ 0,42 SAY "N§:" ;
	SIZE 1,3, 0
@ 0,3 SAY "Tipo de Recibo:" ;
	SIZE 1,15, 0
@ 1,0 TO 1,62
@ 2,3 SAY "Fecha...:" ;
	SIZE 1,9, 0
@ 4,3 SAY "Cliente.:" ;
	SIZE 1,9, 0
@ 5,3 SAY "Cobrador:" ;
	SIZE 1,9, 0
@ 6,3 SAY "Comisiўn:" ;
	SIZE 1,9, 0
@ 7,0 TO 7,62
@ 8,13 SAY "Importe de ‚sta cobranza:" ;
	SIZE 1,25, 0
@ 3,39 SAY "Local:" ;
	SIZE 1,6, 0
@ 2,25 SAY "Con Factura (S/N) ?:" ;
	SIZE 1,20, 0
@ 0,19 GET m.tiporeci ;
	SIZE 1,1 ;
	DEFAULT 0 ;
	PICTURE "9" ;
	WHEN plAdding ;
	VALID _16g0wson9()
@ 0,46 GET m.nroreci ;
	SIZE 1,7 ;
	DEFAULT 0 ;
	PICTURE "9999999" ;
	WHEN plAdding ;
	VALID _16g0wsoph()
@ 2,13 GET m.fechareci ;
	SIZE 1,10 ;
	DEFAULT " " ;
	PICTURE "99/99/9999" ;
	WHEN plAdding .OR. plEditing ;
	VALID _16g0wsoqt()
@ 2,46 GET m.factura ;
	SIZE 1,1 ;
	DEFAULT " " ;
	PICTURE "@A!" ;
	VALID _16g0wsosz()
@ 3,46 GET m.local ;
	SIZE 1,2 ;
	DEFAULT 0 ;
	PICTURE "99" ;
	WHEN plAdding .OR. plEditing ;
	VALID _16g0wsoti()
@ 4,13 GET m.cliente ;
	SIZE 1,5 ;
	DEFAULT " " ;
	PICTURE "99999" ;
	MESSAGE _16g0wsowh()
@ 5,13 GET m.cobrador ;
	SIZE 1,3 ;
	DEFAULT 0 ;
	PICTURE "999" ;
	VALID _16g0wsowy()
@ 6,13 GET m.comision ;
	SIZE 1,6 ;
	DEFAULT 0 ;
	PICTURE "999.99" ;
	WHEN .F. ;
	VALID _16g0wsoxg()
@ 8,39 GET monto_cobr ;
	SIZE 1,11 ;
	DEFAULT 0 ;
	PICTURE "999,999,999" ;
	WHEN m.factura = "N" ;
	VALID _16g0wsoy1()

IF NOT WVISIBLE("_16g0wsoi2")
	ACTIVATE WINDOW _16g0wsoi2
ENDIF


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є     MS-DOSREAD contains clauses from SCREEN cobros      є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

READ CYCLE ;
	SHOW _16g0wsoym() ;
	MODAL COLOR , W+/BG

RELEASE WINDOW _16g0wsoi2
SELECT (m.currarea)


#REGION 0
IF m.talkstat = "ON"
	SET TALK ON
ENDIF
IF m.compstat = "ON"
	SET COMPATIBLE ON
ENDIF


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є               COBROS/MS-DOS Cleanup Code                є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

#REGION 1


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є   COBROS/MS-DOS Supporting Procedures and Functions     є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

#REGION 1
FUNCTION NextNumber

PRIVATE pnSelect, pcOrder, pnRecNo
pnSelect = SELECT()
pcOrder  = ORDER()
pnRecNo  = IIF(EOF(), 0, RECNO())

SELECT cabecob
SET ORDER TO TAG indice1 OF cabecob.cdx DESCENDING

IF SEEK(STR(m.tiporeci, 1))
   NextCode = cabecob.nroreci + 1
ELSE
   NextCode = 1
ENDIF

SET ORDER TO TAG indice1 OF cabecob.cdx ASCENDING

SELECT (pnSelect)
SET ORDER TO TAG (pcOrder)
IF pnRecNo <> 0
   GOTO RECORD pnRecNo
ENDIF

RETURN (NextCode)


FUNCTION _brwLoadDetail
	
DO SaveWorkArea

SELECT tmpdetmovi
SET ORDER TO

IF RECCOUNT() = 0
   INSERT INTO tmpdetmovi (tipobole, nrobole, articulo, cantidad) ;
      VALUES (0, 0, "", 0)
ENDIF

ON KEY LABEL "F8" DO _DeleteLine

DO WHILE LASTKEY() # 27

   GO BOTTOM

   BROWSE WINDOW dtlAjustes FIELDS ;
      calc_f1 = RECNO()                        :R:04:H = "N§" :W = .F. :P = "9999" ,;
      articulo                                   :15:H = "Cўdigo" :V = _vldCodigo(articulo) :F ,;
      calc_f2 = SUBSTR(maesprod.nombre, 1, 40) :R:44:H = "Descripciўn" :W = .F. ,;
      cantidad                                   :10:H = "Cantidad" :P= "9999999.99" :V = _vldCantidad(cantidad) :F NODELETE NOAPPEND
ENDDO

ON KEY LABEL "F8"

DO RestoreWorkArea


FUNCTION _vldAddNewLine
IF LASTKEY() = K_ENTER
   IF RECNO() = RECCOUNT()
      KEYBOARD "{CTRL+W}"
      INSERT INTO tmpdetmovi (tipobole, nrobole, articulo, cantidad) ;
         VALUES (0, 0, " ", 0)
   ENDIF
ENDIF



FUNCTION _DeleteLine

DO SaveWorkArea

SELECT tmpdetmovi
DELETE
PACK

IF RECCOUNT() = 0
   INSERT INTO tmpdetmovi (tipobole, nrobole, articulo, cantidad) ;
      VALUES (0, 0, "", 0)
ENDIF

DO RestoreWorkArea


FUNCTION _vldCantidad
PARAMETER pnCantidad

IF pnCantidad <= 0
   WAIT WINDOW "­ LA CANTIDAD DEBE SER MAYOR QUE CERO !"
   RETURN .F.
ENDIF
DO _vldAddNewLine


FUNCTION _vldCodigo
PARAMETER pnCodigo

IF LASTKEY() = K_DOWN
   RETURN .T.
ENDIF
IF LASTKEY() = K_F8
   RETURN .T.
ENDIF

IF EMPTY(pnCodigo)
   PUSH KEY CLEAR
   ON KEY LABEL "ENTER" KEYBOARD "{CTRL+W}"
   DO _brwMaesprod
   ON KEY LABEL "ENTER"
   POP KEY
   IF NOT LASTKEY() = K_ESCAPE
      pnCodigo = tmpdetmovi.articulo
   ELSE
      RETURN .F.
   ENDIF
ENDIF

SELECT maesprod
SET ORDER TO TAG indice1 OF maesprod.cdx

PRIVATE pnRecNo
pnRecNo  = IIF(EOF(), 0, RECNO())

IF NOT SEEK(pnCodigo)
   WAIT WINDOW "­ CODIGO DE ARTICULO INEXISTENTE !"
   IF pnRecNo # 0
      GOTO RECORD pnRecNo
   ENDIF
   RETURN .F.
ENDIF


FUNCTION _brwMaesprod

DO SaveWorkArea

*-- MS-DOS Definiciones de ventanas.
IF NOT WEXIST("brwMaesprod")
   DEFINE WINDOW brwMaesprod ;
      FROM 01,00 ;
      TO   23,79 ;
      TITLE "< ARTICULOS >" ;
      SYSTEM ;
      CLOSE ;
      FLOAT ;
      GROW ;
      MDI ;
      NOMINIMIZE ;
      SHADOW ;
      ZOOM ;
      COLOR SCHEME 15
ENDIF

SELECT maesprod
SET ORDER TO TAG indice2 OF maesprod.cdx
GO TOP

*-- MS-DOS Macros de teclado.
ON KEY LABEL "F2" DO _AddMaesprod
ON KEY LABEL "F3" DO _EditMaesprod
ON KEY LABEL "F4" DO mporden.spr
ON KEY LABEL "F5" DO mpswitch.prg
ON KEY LABEL "F8" DO maesprod.prg WITH "Delete"
ON KEY LABEL "CTRL+HOME" GO TOP
ON KEY LABEL "CTRL+END"  GO BOTTOM

BROWSE WINDOW brwMaesprod FIELDS ;
   calc_f1 = SUBSTR(codigo, 1, 9)                       :R:09:H = "Cўdigo" ,;
   calc_f2 = SUBSTR(nombre, 1, 39)                      :R:39:H = "Nombre" ,;
   calc_f3 = IIF(impuesto, "S", "")                     :R:01:H = "",;
   pventag1                                             :R:10:H = "P.Vta 1":P = "99,999,999" ,;
   calc_f4 = ROUND(pventag1 * (1 + pimpuesto / 100), 0) :R:13:H = "P.Vta 1 c/Iva":P = "9,999,999,999" ,;
   pventag2                                             :R:10:H = "P.Vta 2":P = "99,999,999" ,;
   calc_f5 = ROUND(pventag2 * (1 + pimpuesto / 100), 0) :R:13:H = "P.Vta 2 c/Iva":P = "9,999,999,999" ,;
   pventag3                                             :R:10:H = "P.Vta 3":P = "99,999,999" ,;
   calc_f6 = ROUND(pventag3 * (1 + pimpuesto / 100), 0) :R:13:H = "P.Vta 3 c/Iva":P = "9,999,999,999" ,;
   calc_f7 = IIF(impuesto, "   SЎ   ", "")              :R:08:H = "Impuesto" ,;
   stock_actu                                           :R:13:H = "Stock Actual":P = "99,999,999.99" ,;
   calc_f8  = SUBSTR(rubros1.nombre, 1, 30)             :R:30:H = "Rubro" ,;
   calc_f9  = SUBSTR(rubros2.nombre, 1, 30)             :R:30:H = "Sub-Rubro",;
   calc_f10 = SUBSTR(marcas.nombre, 1, 30)              :R:30:H = "Marcas",;
   calc_f11 = SUBSTR(nombre, 1, 40)                     :R:40:H = "Nombre" ,;
   calc_f12 = SUBSTR(codigo2, 1, 15)                    :R:15:H = "Cўd.Alternativo" ,;
   calc_f13 = SUBSTR(codorig, 1, 15)                    :R:15:H = "Cўd. Origen" NOAPPEND NODELETE NOMODIFY

SET ORDER TO TAG indice1 OF maesprod.cdx

*-- MS-DOS Restablece macros de teclado.
ON KEY LABEL "F2"
ON KEY LABEL "F3"
ON KEY LABEL "F4"
ON KEY LABEL "F5"
ON KEY LABEL "F8"
ON KEY LABEL "CTRL+HOME"
ON KEY LABEL "CTRL+END"

IF LASTKEY() # K_ESCAPE
   REPLACE tmpdetmovi.articulo WITH maesprod.codigo
ENDIF

DO RestoreWorkArea

FUNCTION _AddMaesprod
PRIVATE plAdding, plEditing, plDeleting, pnNextScreen, m.codigo, m.codigo2,;
   m.codorig, m.nombre, m.lista3, m.lista4, m.lista5, m.familia, m.rubro,;
   m.subrubro, m.marca, m.unidad, m.proveedor, m.procedenci, m.ubicacion,;
   m.vigente, m.lprecio, m.impuesto, m.pimpuesto, m.pcostog, m.pcostod,;
   m.pcostogr, m.pcostodr, m.pcostogre, m.pcostodre, m.pventag1,;
   m.pventag2, m.pventag3, m.pventag4, m.pventag5, m.pventad1,;
   m.pventad2, m.pventad3, m.pventad4, m.pventad5, m.paumento1,;
   m.paumento2, m.paumento3, m.paumento4, m.paumento5, m.stock_min,;
   m.stock_max, m.polinvsmin, m.polinvsmax, m.garantia, m.caracter1,;
   m.caracter2, m.caracter3, m.otros1, m.otros2, m.fecucompra, m.fecrepo,;
   m.stock_actu, m.stock_ot


PUSH KEY CLEAR

SELECT maesprod
SCATTER MEMVAR MEMO BLANK

plAdding     = .T.
plEditing    = .F.
plDeleting   = .F.
pnNextScreen = 1
pnSaveWarn   = 0

DO WHILE  pnNextScreen # 0
   DO CASE
      CASE pnNextScreen = 1
         DO maespro1.spr
      CASE pnNextScreen = 2
         DO maespro2.spr
   ENDCASE
ENDDO

IF pnSaveWarn = 1
   APPEND BLANK
   GATHER MEMVAR MEMO
ENDIF

plAdding     = .F.
plEditing    = .F.
plDeleting   = .F.
pnNextScreen = 0
pnSaveWarn   = 0

POP KEY

FUNCTION _EditMaesprod
PRIVATE plAdding, plEditing, plDeleting, pnNextScreen, pcAppend, m.codigo,;
   m.codigo2, m.codorig, m.nombre, m.lista3, m.lista4, m.lista5, m.familia,;
   m.rubro, m.subrubro, m.marca, m.unidad, m.proveedor, m.procedenci,;
   m.ubicacion, m.vigente, m.lprecio, m.impuesto, m.pimpuesto, m.pcostog,;
   m.pcostod, m.pcostogr, m.pcostodr, m.pcostogre, m.pcostodre, m.pventag1,;
   m.pventag2, m.pventag3, m.pventag4, m.pventag5, m.pventad1, m.pventad2,;
   m.pventad3, m.pventad4, m.pventad5, m.paumento1, m.paumento2,;
   m.paumento3, m.paumento4, m.paumento5, m.stock_min, m.stock_max,;
   m.polinvsmin, m.polinvsmax, m.garantia, m.caracter1, m.caracter2,;
   m.caracter3, m.otros1, m.otros2, m.fecucompra, m.fecrepo, m.stock_actu,;
   m.stock_ot

PUSH KEY CLEAR

SELECT maesprod

IF DELETED()
   WAIT WINDOW "ESTE ARTICULO YA HA SIDO BORRADO, NO SE PUEDE EFECTUAR MODIFICACIONES !"
   POP KEY
   RETURN
ENDIF

IF EOF()
   DO WHILE .T.
      WAIT WINDOW "    LA TABLA SE ENCUENTRA VACIA" + CHR(13) + "Ё DESEA AGREGAR UN NUEVO REGISTRO ? [S/N]" TO pcAppend
      IF UPPER(pcAppend) = "S"
         DO _AddMaesprod
         EXIT DO
      ENDIF
      IF UPPER(pcAppend) = "N"
         EXIT DO
      ENDIF
   ENDDO
   POP KEY
   RETURN
ENDIF

IF .NOT. RLOCK()
   WAIT WINDOW "­ ESTE REGISTRO ESTA SIENDO UTILIZADO POR OTRO USUARIO !"
   POP KEY
   RETURN
ENDIF

SCATTER MEMVAR MEMO

plAdding     = .F.
plEditing    = .T.
plDeleting   = .F.
pnNextScreen = 1
pnSaveWarn   = 0

DO WHILE  pnNextScreen # 0
   DO CASE
      CASE pnNextScreen = 1
         DO maespro1.spr
      CASE pnNextScreen = 2
         DO maespro2.spr
   ENDCASE
ENDDO

IF pnSaveWarn = 1
   GATHER MEMVAR MEMO FIELDS codigo, codigo2, codorig, nombre, lista3,;
      lista4, lista5, familia, rubro, subrubro, marca, unidad, proveedor,;
      procedenci, ubicacion, vigente, lprecio, impuesto, pimpuesto,;
      pcostog, pcostod, pcostogr, pcostodr, pcostogre, pcostodre,;
      pventag1, pventag2, pventag3, pventag4, pventag5, pventad1,;
      pventad2, pventad3, pventad4, pventad5, paumento1, paumento2,;
      paumento3, paumento4, paumento5, stock_min, stock_max, polinvsmin,;
      polinvsmax, garantia, caracter1, caracter2, caracter3, otros1,;
      otros2, fecucompra, fecrepo
ENDIF

UNLOCK IN maesprod

plAdding     = .F.
plEditing    = .F.
plDeleting   = .F.
pnNextScreen = 0
pnSaveWarn   = 0

POP KEY

*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _16G0WSON9           m.tiporeci VALID                   є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         COBROS,     Record Number:   13    є
*       є Variable:            m.tiporeci                         є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Field                              є
*       є Snippet Number:      1                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _16g0wson9     &&  m.tiporeci VALID
#REGION 1
IF INLIST(LASTKEY(), 5, 19, 28, 127)
   RETURN .F.
ENDIF

IF m.tiporeci > 2
   @ 00,22 SAY REPLICATE(CHR(32), 16) ;
      SIZE 1,16 ;
      PICTURE "@" ;
      COLOR W/N
   WAIT WINDOW "­ EL TIPO DE DOCUMENTO DE COBRO DEBE SER: 1 а 2 !"
   RETURN .F.
ENDIF

IF m.tiporeci <= 0
   @ 00,22 SAY REPLICATE(CHR(32), 16) ;
      SIZE 1,16 ;
      PICTURE "@" ;
      COLOR W/N
   DO cbtipodo.spr WITH "m.tiporeci", 0, .F.
ENDIF

IF m.tiporeci = 0
   RETURN .F.
ENDIF

DO CASE
   CASE m.tiporeci = 1
      @ 00,22 SAY "RECIBO DE COBRO" ;
         SIZE 1,16 ;
         PICTURE "@!" ;
         COLOR W/N
      m.nroreci = NextNumber()
   CASE m.tiporeci = 2
      @ 00,22 SAY "C.I. DE COBRO" ;
         SIZE 1,16 ;
         PICTURE "@!" ;
         COLOR W/N
      m.nroreci = NextNumber()
   OTHERWISE
      @ 00,22 SAY REPLICATE(CHR(32),16) ;
         SIZE 1,16 ;
         PICTURE "@!" ;
         COLOR W/N
      m.nroreci = 0
ENDCASE

*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _16G0WSOPH           m.nroreci VALID                    є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         COBROS,     Record Number:   14    є
*       є Variable:            m.nroreci                          є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Field                              є
*       є Snippet Number:      2                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _16g0wsoph     &&  m.nroreci VALID
#REGION 1
IF INLIST(LASTKEY(), 5, 19, 27, 127)
   RETURN
ENDIF

IF m.nroreci <= 0
   WAIT WINDOW "­ EL N§ DEL DOCUMENTO DEBE SER MAYOR QUE CERO !"
   RETURN .F.
ENDIF

PRIVATE pnSelect, pcOrder, pnRecNo
pnSelect = SELECT()
pcOrder  = ORDER()
pnRecNo  = IIF(EOF(), 0, RECNO())

SELECT cabecob
SET ORDER TO TAG indice1 OF cabecob.cdx
IF SEEK(STR(m.tiporeci, 1) + STR(m.nroreci, 7))
   WAIT WINDOW "­ ESTE DOCUMENTO YA HA SIDO CARGADO !"

   SELECT (pnSelect)
   SET ORDER TO TAG (pcOrder)
   IF pnRecNo <> 0
      GOTO RECORD pnRecNo
   ENDIF

   RETURN .F.
ENDIF

SELECT (pnSelect)
SET ORDER TO TAG (pcOrder)
IF pnRecNo <> 0
   GOTO RECORD pnRecNo
ENDIF

*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _16G0WSOQT           m.fechareci VALID                  є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         COBROS,     Record Number:   15    є
*       є Variable:            m.fechareci                        є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Field                              є
*       є Snippet Number:      3                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _16g0wsoqt     &&  m.fechareci VALID
#REGION 1
IF INLIST(LASTKEY(), 5, 19, 27, 127)
   RETURN
ENDIF

PRIVATE pnDia, pnMes, pnAnyo

IF m.fechareci = "00/00/0000" .OR. m.fechareci = "  /  /    "
   WAIT WINDOW "­ FECHA INVALIDA !"
   RETURN .F.
ELSE
   STORE VAL(SUBSTR(m.fechareci,1,2)) TO pnDia
   STORE VAL(SUBSTR(m.fechareci,4,2)) TO pnMes

   IF VAL(SUBSTR(m.fechareci,7,4)) < 1000
      pnAnyo = YEAR(DATE())
   ELSE
      pnAnyo = VAL(SUBSTR(m.fechareci,7,4))
   ENDIF

   m.fechareci = IIF(pnDia > 0 .AND. pnDia < 10, "0"+STR(pnDia,1), STR(pnDia,2)) +  "/"+ IIF(pnMes > 0 .AND. pnMes < 10, "0"+STR(pnMes,1), STR(pnMes,2)) + "/"+ STR(pnAnyo,4)

   IF pnDia  < 1    .OR. pnDia  > 31 .OR.;
      pnMes  < 1    .OR. pnMes  > 12 .OR.;
      pnAnyo < 1900 .OR. pnAnyo > 2500
      WAIT WINDOW "­ FECHA INVALIDA !"
      RETURN .F.
   ELSE
      DO CASE
         CASE INLIST(pnMes, 1, 3, 5, 7, 8, 10, 12)
            IF pnDia <= 31
               RETURN .T.
            ELSE
               WAIT WINDOW "­ FECHA INVALIDA !"
               RETURN .F.
            ENDIF
         CASE pnMes = 2
            IF MOD(pnAnyo,4) # 0
               IF pnDia <= 28
                  RETURN .T.
               ELSE
                  WAIT WINDOW "­ FECHA INVALIDA !"
                  RETURN .F.
               ENDIF
            ELSE
               IF MOD(pnAnyo,100) = 0 .AND. MOD(pnAnyo,400) # 0
                  IF pnDia <= 28
                     RETURN .T.
                  ENDIF
               ELSE
                  IF pnDia <= 29
                     RETURN .T.
                  ELSE
                     WAIT WINDOW "­ FECHA INVALIDA !"
                     RETURN .F.
                  ENDIF
               ENDIF
            ENDIF
         CASE INLIST(pnMes, 4, 6, 9, 11)
            IF pnDia <= 30
               RETURN .T.
            ELSE
               WAIT WINDOW "­ FECHA INVALIDA !"
               RETURN .F.
            ENDIF
            RETURN .T.
      ENDCASE
   ENDIF
ENDIF


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _16G0WSOSZ           m.factura VALID                    є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         COBROS,     Record Number:   16    є
*       є Variable:            m.factura                          є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Field                              є
*       є Snippet Number:      4                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _16g0wsosz     &&  m.factura VALID
#REGION 1
IF INLIST(LASTKEY(), 5, 19, 27, 127)
   RETURN
ENDIF


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _16G0WSOTI           m.local VALID                      є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         COBROS,     Record Number:   17    є
*       є Variable:            m.local                            є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Field                              є
*       є Snippet Number:      5                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _16g0wsoti     &&  m.local VALID
#REGION 1
IF INLIST(LASTKEY(), 5, 19, 27, 127)
   RETURN
ENDIF

IF m.local > 5
   @ 03,50 SAY REPLICATE(CHR(32), 12) ;
      SIZE 1,12 ;
      PICTURE "@!" ;
      COLOR W/N
   WAIT WINDOW "­ EL CODIGO DEL LOCAL DEBE SER: 1, 2, 3, 4 а 5 !"
   RETURN .F.
ENDIF
IF m.local <= 0
   @ 03,50 SAY REPLICATE(CHR(32), 12) ;
      SIZE 1,12 ;
      PICTURE "@!" ;
      COLOR W/N
   DO localpop.spr WITH "m.local", 0, .F.
   SHOW GETS
ENDIF
IF m.local = 0
   RETURN .F.
ENDIF
DO CASE
   CASE m.local = 1
      @ 03,50 SAY "-" ;
         SIZE 1,12 ;
         PICTURE "@!" ;
         COLOR W/N
   CASE m.local = 2
      @ 03,50 SAY "CASA CENTRAL" ;
         SIZE 1,12 ;
         PICTURE "@!" ;
         COLOR W/N
   CASE m.local = 3
      @ 03,50 SAY "SUC. UNO" ;
         SIZE 1,12 ;
         PICTURE "@!" ;
         COLOR W/N
   CASE m.local = 4
      @ 03,50 SAY "SUC. DOS" ;
         SIZE 1,12 ;
         PICTURE "@!" ;
         COLOR W/N
   CASE m.local = 5
      @ 03,50 SAY "SUC. TRES" ;
         SIZE 1,12 ;
         PICTURE "@!" ;
         COLOR W/N
   OTHERWISE
      @ 03,50 SAY REPLICATE(CHR(32), 12) ;
         SIZE 1,12 ;
         PICTURE "@!" ;
         COLOR W/N
ENDCASE

*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _16G0WSOWH           m.cliente MESSAGE                  є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         COBROS,     Record Number:   18    є
*       є Variable:            m.cliente                          є
*       є Called By:           MESSAGE Clause                     є
*       є Object Type:         Field                              є
*       є Snippet Number:      6                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _16g0wsowh     &&  m.cliente MESSAGE
#REGION 1
IF INLIST(LASTKEY(), 5, 19, 27, 127)
   RETURN
ENDIF


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _16G0WSOWY           m.cobrador VALID                   є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         COBROS,     Record Number:   19    є
*       є Variable:            m.cobrador                         є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Field                              є
*       є Snippet Number:      7                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _16g0wsowy     &&  m.cobrador VALID
#REGION 1
IF INLIST(LASTKEY(), 5, 19, 27, 127)
   RETURN
ENDIF


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _16G0WSOXG           m.comision VALID                   є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         COBROS,     Record Number:   20    є
*       є Variable:            m.comision                         є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Field                              є
*       є Snippet Number:      8                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _16g0wsoxg     &&  m.comision VALID
#REGION 1
IF INLIST(LASTKEY(), 5, 19, 27, 127)
   RETURN
ENDIF

IF m.comision < 0
   WAIT WINDOW "­ EL IMPORTE DE LA COBRANZA DEBE SER MAYOR O IGUAL QUE CERO !"
   RETURN .F.
ENDIF

*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _16G0WSOY1           monto_cobr VALID                   є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         COBROS,     Record Number:   21    є
*       є Variable:            monto_cobr                         є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Field                              є
*       є Snippet Number:      9                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _16g0wsoy1     &&  monto_cobr VALID
#REGION 1
IF INLIST(LASTKEY(), 5, 19, 27, 127)
   RETURN
ENDIF

IF m.monto_cobr <= 0
   WAIT WINDOW "­ EL IMPORTE DE LA COBRANZA DEBE SER MAYOR QUE CERO !"
   RETURN .F.
ENDIF

*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _16G0WSOYM           Read Level Show                    є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         COBROS                             є
*       є Called By:           READ Statement                     є
*       є Snippet Number:      10                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _16g0wsoym     && Read Level Show
PRIVATE currwind
STORE WOUTPUT() TO currwind
*
* Show Code from screen: COBROS
*
#REGION 1
DO CASE
   CASE m.tiporeci = 1
      @ 00,22 SAY "RECIBO DE COBRO" ;
         SIZE 1,16 ;
         PICTURE "@!" ;
         COLOR W/N
   CASE m.tiporeci = 2
      @ 00,22 SAY "C.I. DE COBRO" ;
         SIZE 1,16 ;
         PICTURE "@!" ;
         COLOR W/N
   OTHERWISE
      @ 00,22 SAY REPLICATE(CHR(32),16) ;
         SIZE 1,16 ;
         PICTURE "@!" ;
         COLOR W/N
ENDCASE

DO CASE
   CASE m.local = 1
      @ 03,50 SAY "-" ;
         SIZE 1,12 ;
         PICTURE "@!" ;
         COLOR W/N
   CASE m.local = 2
      @ 03,50 SAY "CASA CENTRAL" ;
         SIZE 1,12 ;
         PICTURE "@!" ;
         COLOR W/N
   CASE m.local = 3
      @ 03,50 SAY "SUC. UNO" ;
         SIZE 1,12 ;
         PICTURE "@!" ;
         COLOR W/N
   CASE m.local = 4
      @ 03,50 SAY "SUC. DOS" ;
         SIZE 1,12 ;
         PICTURE "@!" ;
         COLOR W/N
   CASE m.local = 5
      @ 03,50 SAY "SUC. TRES" ;
         SIZE 1,12 ;
         PICTURE "@!" ;
         COLOR W/N
   OTHERWISE
      @ 03,50 SAY REPLICATE(CHR(32), 12) ;
         SIZE 1,12 ;
         PICTURE "@!" ;
         COLOR W/N
ENDCASE
IF NOT EMPTY(currwind)
	ACTIVATE WINDOW (currwind) SAME
ENDIF