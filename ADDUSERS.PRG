*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        04/27/04            ADDUSERS.PRG               17:07:44 
*                                                                
*       픔컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        Author's Name                                           
*                                                                
*        Copyright (c) 2004 Company Name                         
*        Address                                                 
*        City,     Zip                                           
*                                                                
*        Description:                                            
*        This program was automatically generated by GENSCRN.    
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴

PARAMETERS m.cardid

*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*                ADDUSERS/MS-DOS Setup Code - SECTION 1          
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

#REGION 1


#REGION 0
REGIONAL m.currarea, m.talkstat, m.compstat

IF SET("TALK") = "ON"
	SET TALK OFF
	m.talkstat = "ON"
ELSE
	m.talkstat = "OFF"
ENDIF
m.compstat = SET("COMPATIBLE")
SET COMPATIBLE FOXPLUS

m.currarea = SELECT()


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*                       MS-DOS Window definitions                
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

IF NOT WEXIST("_18210poog")
	DEFINE WINDOW _18210poog ;
		FROM INT((SROW()-15)/2),INT((SCOL()-80)/2) ;
		TO INT((SROW()-15)/2)+14,INT((SCOL()-80)/2)+79 ;
		FLOAT ;
		NOCLOSE ;
		SHADOW ;
		NOMINIMIZE ;
		DOUBLE ;
		COLOR SCHEME 5
ENDIF


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*                ADDUSERS/MS-DOS Setup Code - SECTION 2          
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

#REGION 1
PRIVATE m.mover, m.user, m.allcnt, m.saverec, m.usrcnt, m.limit, ;
	allusers, m.status, m.savearea,  m.userlast, m.userfirst

SET EXACT ON
m.user = 1
m.userlast = ""
m.status   = .T.
m.savearea = SELECT()
DIMENSION allusers[1,3]
allusers = ""

*IF NOT locatedb("carduser",1)
*	RETURN
*ENDIF

m.saverec = RECNO()
SELECT DISTINCT servicio.articulo, maesprod.nombre, servicio.pcomision, ;
    SUBSTR(maesprod.nombre, 1, 18) + ;
            "  " + STR(servicio.pcomision, 6, 2) ;
	FROM servicio, maesprod ;
    WHERE maesprod.codigo = servicio.articulo ;
	INTO ARRAY allusers

m.allcnt = ALEN(allusers,1)

IF EMPTY(users)
	m.usrcnt = 0
ELSE
	m.usrcnt = 1
	m.limit  = ALEN(users,1)
	DO WHILE m.usrcnt <= m.limit
		IF EMPTY(users[m.usrcnt,1])
			EXIT
		ENDIF
		m.usrcnt = m.usrcnt + 1
	ENDDO
	m.usrcnt = m.usrcnt - 1
ENDIF

*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*                     ADDUSERS/MS-DOS Screen Layout              
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

#REGION 1
IF WVISIBLE("_18210poog")
	ACTIVATE WINDOW _18210poog SAME
ELSE
	ACTIVATE WINDOW _18210poog NOSHOW
ENDIF
@ 3,32 GET m.mover ;
	PICTURE "@*VN \<Mover ;   \<Quitar;\\Quitar \<Todo;\!\<Aceptar" ;
	SIZE 1,14,1 ;
	DEFAULT 1 ;
	VALID _18210poov()
@ 2,0 GET m.alluser ;
 	PICTURE "@&N" ;
	FROM allusers ;
	RANGE 4, m.allcnt ;
	SIZE 10,31 ;
	DEFAULT 1 ;
	VALID _18210pooz() ;
	COLOR SCHEME 5
@ 2,47 GET m.user ;
 	PICTURE "@&N" ;
	FROM users ;
	RANGE 5, usrcnt ;
	SIZE 10,31 ;
	DEFAULT 1 ;
	VALID _18210pop0() ;
	COLOR SCHEME 5
@ 1,1 SAY "Lista de Selecci줻:" ;
	SIZE 1,19, 0
@ 1,48 SAY "Servicio Autorizado:" ;
	SIZE 1,20, 0

IF NOT WVISIBLE("_18210poog")
	ACTIVATE WINDOW _18210poog
ENDIF


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*           MS-DOSREAD contains clauses from SCREEN addusers     
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

READ CYCLE ;
	WHEN _18210pop2() ;
	ACTIVATE _18210pop3() ;
	SHOW _18210pop4() ;
	MODAL COLOR , W+/BG

RELEASE WINDOW _18210poog
SELECT (m.currarea)


#REGION 0
IF m.talkstat = "ON"
	SET TALK ON
ENDIF
IF m.compstat = "ON"
	SET COMPATIBLE ON
ENDIF


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*                     ADDUSERS/MS-DOS Cleanup Code               
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

#REGION 1
SET EXACT OFF

ON KEY LABEL esc
SELECT (m.savearea)
RETURN m.status

*
* ALREADYIN - Check if name already in the list.
*


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*         ADDUSERS/MS-DOS Supporting Procedures and Functions    
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

#REGION 1
FUNCTION alreadyin
PARAMETER m.newname
SET EXACT OFF
IF ASCAN(users, ALLTRIM(m.newname)) <> 0
	RETURN .T.
ENDIF
SET EXACT ON
RETURN .F.

*
* ESCHANDLER - Handle ESC-aping out of a field.
*
PROCEDURE eschandler
ON KEY LABEL esc
m.userlast  = SPACE(22)
m.userfirst = SPACE(14)
SHOW GET m.userlast DISABLE
SHOW GET m.userfirst DISABLE


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _18210POOV           m.mover VALID                      
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         ADDUSERS,     Record Number:    2  
*        Variable:            m.mover                            
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      1                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _18210poov     &&  m.mover VALID
#REGION 1
DO CASE
CASE m.mover = 1
	IF alreadyin(allusers[m.alluser,4]))
		WAIT WINDOW "Entrada duplicada" NOWAIT
		RETURN .F.
	ENDIF
	IF m.usrcnt+1 > ALEN(users,1)
		DIMENSION users[m.usrcnt+1,5]
	ENDIF
	users[m.usrcnt+1,1] = m.codigo
	users[m.usrcnt+1,2] = allusers[m.alluser,1]
	users[m.usrcnt+1,3] = allusers[m.alluser,2]
	users[m.usrcnt+1,4] = allusers[m.alluser,3]
	users[m.usrcnt+1,5] = allusers[m.alluser,4]
	m.usrcnt = m.usrcnt + 1
	m.user = m.usrcnt
	SHOW GET m.mover, 2 ENABLE
	IF m.usrcnt > 1
		SHOW GET m.mover, 3 ENABLE
	ENDIF
	SHOW GET m.user
CASE m.mover = 2
	= ADEL(users, m.user)
	m.usrcnt = m.usrcnt - 1
	m.user = m.usrcnt
	
	IF m.usrcnt = 0
		SHOW GET m.mover, 2 DISABLE
		SHOW GET m.mover, 3 DISABLE
	ENDIF
	SHOW GET m.user
CASE m.mover = 3
	users = ""
	m.usrcnt = 0
	SHOW GET m.mover, 2 DISABLE
	SHOW GET m.mover, 3 DISABLE
	SHOW GET m.user
CASE m.mover = 5
	m.userlast  = SPACE(22)
	m.userfirst = SPACE(14)
	SHOW GET m.userlast ENABLE
	_CUROBJ = OBJNUM(m.userlast)
CASE m.mover = 4
   SHOW GET m.user
   CLEAR READ
ENDCASE


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _18210POOZ           m.alluser VALID                    
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         ADDUSERS,     Record Number:    3  
*        Variable:            m.alluser                          
*        Called By:           VALID Clause                       
*        Object Type:         List                               
*        Snippet Number:      2                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _18210pooz     &&  m.alluser VALID
#REGION 1
IF alreadyin(allusers[m.alluser,4])
	WAIT WINDOW "Entrada Duplicada" NOWAIT
	RETURN .F.
ENDIF
IF m.usrcnt+1 > ALEN(users,1)
	DIMENSION users[m.usrcnt+1,5]
ENDIF
	
users[m.usrcnt+1,1] = m.codigo
users[m.usrcnt+1,2] = allusers[m.alluser,1]
users[m.usrcnt+1,3] = allusers[m.alluser,2]
users[m.usrcnt+1,4] = allusers[m.alluser,3]
users[m.usrcnt+1,5] = allusers[m.alluser,4]
m.usrcnt = m.usrcnt + 1
m.user = m.usrcnt

SHOW GET m.mover, 2 ENABLE
IF m.usrcnt > 1
	SHOW GET m.mover, 3 ENABLE
ENDIF
SHOW GET m.user
		


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _18210POP0           m.user VALID                       
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         ADDUSERS,     Record Number:    4  
*        Variable:            m.user                             
*        Called By:           VALID Clause                       
*        Object Type:         List                               
*        Snippet Number:      3                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _18210pop0     &&  m.user VALID
#REGION 1
= ADEL(users, m.user)
m.usrcnt = m.usrcnt - 1
m.user = m.usrcnt
		
IF m.usrcnt = 0
	SHOW GET m.mover, 2 DISABLE
	SHOW GET m.mover, 3 DISABLE
ENDIF
SHOW GET m.user


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _18210POP2           Read Level When                    
*                                                                
*        Function Origin:                                        
*                                                                
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         ADDUSERS                           
*        Called By:           READ Statement                     
*        Snippet Number:      4                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _18210pop2     && Read Level When
*
* When Code from screen: ADDUSERS
*
#REGION 1
IF EMPTY(m.cardid)
	WAIT WINDOW "You must enter card id first" NOWAIT
	m.status = .F.
	RETURN .F.
ENDIF

*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _18210POP3           Read Level Activate                
*                                                                
*        Function Origin:                                        
*                                                                
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         ADDUSERS                           
*        Called By:           READ Statement                     
*        Snippet Number:      5                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _18210pop3     && Read Level Activate
*
* Activate Code from screen: ADDUSERS
*
#REGION 1
SHOW GET m.mover, 1 PROMPT "\<Mover "+CHR(26)
SHOW GET m.mover, 2 PROMPT CHR(27)+" \<Quitar"

IF EMPTY(allusers)
	SHOW GET m.alluser DISABLE
ENDIF
IF m.usrcnt=0
	SHOW GET m.mover, 2 DISABLE
ENDIF

*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _18210POP4           Read Level Show                    
*                                                                
*        Function Origin:                                        
*                                                                
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         ADDUSERS                           
*        Called By:           READ Statement                     
*        Snippet Number:      6                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _18210pop4     && Read Level Show
PRIVATE currwind
STORE WOUTPUT() TO currwind
*
* Show Code from screen: ADDUSERS
*
#REGION 1
IF m.usrcnt > 1
	SHOW GET m.mover, 3 ENABLE
ENDIF
IF NOT EMPTY(currwind)
	ACTIVATE WINDOW (currwind) SAME
ENDIF